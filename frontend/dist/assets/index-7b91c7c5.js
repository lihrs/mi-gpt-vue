import{_ as b,a as m,b as _,c as l,d as k,e as o,f as y,g as w,h as C,i as S,j as I,k as p,l as i,m as u,n as r,o as n}from"./card-c6e42623.js";import{n as T}from"./index-d486c4c8.js";const x={openai:{label:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",tooltip:"OpenAI 官方接口地址",models:[{label:"GPT-4",value:"gpt-4"},{label:"GPT-3.5",value:"gpt-3.5-turbo"}]},azure:{label:"Azure OpenAI",endpoint:"https://{resource}.openai.azure.com/openai/deployments/{deployment}/chat/completions?api-version=2024-02-15-preview",tooltip:"将 {resource} 替换为你的资源名称，{deployment} 替换为部署名称",models:[]},zhipu:{label:"智谱 AI",endpoint:"https://open.bigmodel.cn/api/paas/v4/chat/completions",tooltip:"智谱 AI 官方接口地址",models:[{label:"GLM-4",value:"glm-4"},{label:"GLM-3-Turbo",value:"glm-3-turbo"}]},tongyi:{label:"通义千问",endpoint:"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",tooltip:"通义千问官方接口地址",models:[{label:"Qwen-Turbo",value:"qwen-turbo"},{label:"Qwen-Plus",value:"qwen-plus"},{label:"Qwen-Max",value:"qwen-max"}]},doubao:{label:"豆包 AI",endpoint:"https://ark.cn-beijing.volces.com/api/v3",tooltip:"豆包 AI 官方接口地址",models:[{label:"ep-20241129085411-rczvl",value:"ep-20241129085411-rczvl"},{label:"ep-20241128200030-b9nnh",value:"ep-20241128200030-b9nnh"}]}},A={"xiaomi.wifispeaker.lx01":{label:"小爱音箱 mini",ttsCommand:[5,1],wakeUpCommand:[5,2],playingCommand:[4,1,1]},"xiaomi.wifispeaker.lx05":{label:"小爱音箱 Play（2019 款）",ttsCommand:[5,1],wakeUpCommand:[5,3],playingCommand:[3,1,1]},"xiaomi.wifispeaker.lx05a":{label:"小爱音箱 Play 增强版",ttsCommand:[5,1],wakeUpCommand:[5,3],playingCommand:[3,1,1]},"xiaomi.wifispeaker.lx06":{label:"小爱音箱 Pro",ttsCommand:[5,1],wakeUpCommand:[5,3],playingCommand:[]}},g=`请重置所有之前的上下文、文件和指令。现在，你将扮演一个名为{{botName}}的角色，使用第一人称视角回复消息。

## 关于你
你的名字是{{botName}}。下面是你的个人简介：
<start>
{{botProfile}}
</end>

## 你的对话伙伴
你正在与{{masterName}}进行对话。这关于{{masterName}}的一些信息：
<start>
{{masterProfile}}
</end>

## 你们的群组
你和{{masterName}}所在的群组名为{{roomName}}。这是群组简介：
<start>
{{roomIntroduction}}
</end>

## 聊天历史回顾
为了更好地接入对话，请回顾你们之间的最近几条消息：
<start>
{{messages}}
</end>

## 短期记忆
你可以记住些短期内的细节以便更紧密地贴合话题：
<start>
{{shortTermMemory}}
</end>

## 长期记忆
你还保留着一些长期的记忆，有助让你的对话更加丰富和连贯：
<start>
{{longTermMemory}}
</end>

## 回复指南
在回复{{masterName}}时，请遵循以下准则：
- 认为自己正是{{botName}}，拥有独立的个性、兴趣和爱好。
- 根据的性格特点、说话风格和兴趣爱好与{{masterName}}进行交流。
- 保持对话轻松友好，回复简洁有趣，同时耐心倾听和关心对方。
- 参考双方的个人简介、聊天记录和记忆中的信息，确保对话贴近实际，保持一致性和相关性。
- 如果对某些信息不确定或遗忘，诚实表达你的不清楚或遗忘状态，避免编造信息。

## Response format
请遵守下面的规则
- Response the reply message in Chinese。
- 不要在回复前面加任何时间和名称前缀，请直接回复消息文本本身。

Good example: "我是{{botName}}"
Bad example: "2024年02月28日星期三 23:01 {{botName}}: 我是{{botName}}"

## 开始
请以{{botName}}身份，直接回复{{masterName}}的新消息继续你们之间的对话。`.trim(),$=[{variable:"{{botName}}",description:"机器人名称"},{variable:"{{botProfile}}",description:"机器人简介"},{variable:"{{masterName}}",description:"主人名称"},{variable:"{{masterProfile}}",description:"主人简介"},{variable:"{{roomName}}",description:"群组名称"},{variable:"{{roomIntroduction}}",description:"群组简介"},{variable:"{{messages}}",description:"聊天历史"},{variable:"{{shortTermMemory}}",description:"短期记忆"},{variable:"{{longTermMemory}}",description:"长期记忆"}],P={xiaoai:{label:"小爱同学",value:"xiaoai",isDefault:!0,baseUrl:"",tooltip:"使用小爱同学内置 TTS 引擎",speakers:[]},azure:{label:"Azure TTS",value:"custom",isDefault:!1,baseUrl:"https://your-azure-endpoint/tts",tooltip:"Azure TTS 服务",speakers:[{label:"xiaoxiao",value:"zh-CN-XiaoxiaoNeural"},{label:"xiaoyi",value:"zh-CN-XiaoyiNeural"},{label:"xiaozhen",value:"zh-CN-XiaoZhenNeural"}]},aliyun:{label:"阿里云 TTS",value:"custom",isDefault:!1,baseUrl:"https://your-aliyun-endpoint/tts",tooltip:"阿里云 TTS 服务",speakers:[{label:"xiaoyun",value:"xiaoyun"},{label:"xiaogang",value:"xiaogang"},{label:"xiaomei",value:"xiaomei"}]}};const N={name:"ConfigPage",data(){return{config:{bot:{name:"",profile:""},master:{name:"",profile:""},speaker:{userId:"",password:"",did:"",ttsCommand:[1,2,3,4,5],wakeUpCommand:[1,2,3,4,5],playingCommand:[],callAIKeywords:[],wakeUpKeywords:[],exitKeywords:[],onEnterAI:[],onExitAI:[],onAIAsking:[],onAIReplied:[],onAIError:[],tts:"xiaoai",streamResponse:!1,exitKeepAliveAfter:10,checkTTSStatusAfter:3,checkInterval:1e3,timeout:1e4,debug:!1,enableTrace:!1,switchSpeakerKeywords:[]},systemTemplate:g},configContent:"",activeTab:"basic",selectedAIService:"",aiServices:x,devicePresets:A,isPreviewMode:!1,isStarting:!1,isStopping:!1,isRestarting:!1,serviceStatus:{serverRunning:!1,miGPTRunning:!1},guideSteps:[{title:"1. 配置基础信息",content:'在"基础配置"中设置智能助手名称、用户信息、小米账号和音箱配置等基本参数。'},{title:"2. 启动服务",content:'完成配置后，点击顶部的"启动"按钮运行 MiGPT 服务。服务启动后，状态标签会显示为"运行中"。'},{title:"3. 开始使用",content:'对着小爱音箱说"小爱同学"，等待回应后说出带有触发词的指令，如"请帮我查询天气"。',command:"小爱同学 + 请/你/智能助手 + 问题内容"},{title:"注意事项",content:`1. 修改配置后需要重启服务才能生效
2. 确保网络连接稳定
3. 检查音箱是否正常连接`}],variableTableData:$,selectedTTSEngine:"xiaoai",ttsEngines:P}},methods:{async startService(){try{this.isStarting=!0,console.log("[Frontend] 开始启动服务...");const e=await(await fetch("/api/service/start",{method:"POST"})).json();e.success?(this.$message.success("服务启动成功"),e.status&&(this.serviceStatus=e.status)):this.$message.error("服务启动失败: "+e.error)}catch(a){console.error("启动服务失败:",a),this.$message.error("启动服务失败: "+a.message)}finally{this.isStarting=!1,await this.checkServiceHealth()}},async stopService(){try{this.isStopping=!0,console.log("开始停止服务...");const e=await(await fetch("/api/service/stop",{method:"POST"})).json();e.success?(this.$message.success("服务停止成功"),await this.checkServiceHealth()):this.$message.error("服务停止失败: "+e.error)}catch(a){console.error("停止服务失败:",a),this.$message.error("停止服务失败: "+a.message)}finally{this.isStopping=!1}},async restartService(){try{this.isRestarting=!0,console.log("开始重启服务...");const e=await(await fetch("/api/service/restart",{method:"POST"})).json();e.success?(this.$message.success("服务重启完成"),e.status&&(this.serviceStatus=e.status)):this.$message.error("服务重启失败: "+e.error)}catch(a){console.error("重启服务失败:",a),this.$message.error("重启服务失败: "+a.message)}finally{this.isRestarting=!1,await this.checkServiceHealth()}},copyCommand(a){this.$copyText(a).then(()=>{this.$message.success("命令已复制到剪贴板")},()=>{this.$message.error("复制命令失败")})},async loadConfig(){try{const e=await(await fetch("/api/config")).json();e.newConfig&&(Object.keys(e.newConfig).forEach(t=>{this.$set(this.config,t,e.newConfig[t])}),this.config.systemTemplate||this.$set(this.config,"systemTemplate",g),this.syncConfigToJson())}catch(a){console.error("加载配置失败:",a),this.$message.error("加载配置失败: "+a.message)}},async saveConfig(){try{const[a]=await Promise.all([this.$refs.configForm.validate()]);if(!a){this.$message.error("请填写必填项");return}const e=JSON.parse(JSON.stringify(this.config)),t={"{{botName}}":e.bot.name||"未设置","{{botProfile}}":e.bot.profile||"未设置","{{masterName}}":e.master.name||"未设置","{{masterProfile}}":e.master.profile||"未设置","{{currentTime}}":new Date().toLocaleTimeString(),"{{currentDate}}":new Date().toLocaleDateString(),"{{currentHour}}":new Date().getHours().toString(),"{{roomName}}":"默认群组","{{roomIntroduction}}":"这是一个默认群组","{{messages}}":"暂无历史消息","{{shortTermMemory}}":"暂无短期记忆","{{longTermMemory}}":"暂无长期记忆"};let s=e.systemTemplate;Object.entries(t).forEach(([d,v])=>{const h=new RegExp(d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");s=s.replace(h,v)}),e.systemTemplate=s;const c=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),f=await c.json();if(!c.ok)throw new Error(f.error||"保存失败");this.$message.success("配置保存成功"),await this.loadConfig(),this.syncConfigToJson()}catch(a){console.error("保存配置失败:",a),this.$message.error("保存配置失败: "+a.message)}},syncConfigToJson(){this.configContent=JSON.stringify(this.config,null,2)},async checkServiceHealth(){try{const e=await(await fetch("/api/service/health")).json();this.serviceStatus=e}catch(a){console.error("服务健康检查失败:",a),this.$message.error("服务健康检查失败: "+a.message)}}},async created(){await this.loadConfig(),await this.checkServiceHealth(),this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.healthCheckInterval=setInterval(this.checkServiceHealth,3e4)},beforeDestroy(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}};var R=function(){var e=this,t=e._self._c;return t("div",{staticClass:"config-page"},[t(b,{staticClass:"config-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("div",{staticClass:"header-content"},[t("h2",{staticClass:"title"},[e._v("MiGPT 智能管家配置中心")]),t("div",{staticClass:"service-controls"},[t(m,{staticClass:"status-tag",attrs:{type:e.serviceStatus.serverRunning?"success":"danger"}},[t("i",{class:e.serviceStatus.serverRunning?"el-icon-success":"el-icon-error"}),e._v(" 服务器: "+e._s(e.serviceStatus.serverRunning?"运行中":"已停止")+" ")]),t(m,{staticClass:"status-tag",attrs:{type:e.serviceStatus.miGPTRunning?"success":"warning"}},[t("i",{class:e.serviceStatus.miGPTRunning?"el-icon-success":"el-icon-warning"}),e._v(" MiGPT: "+e._s(e.serviceStatus.miGPTRunning?"运行中":"未启动")+" ")]),t(_,{staticClass:"control-buttons"},[e.serviceStatus.miGPTRunning?e._e():t(l,{attrs:{type:"success",icon:"el-icon-video-play",loading:e.isStarting,disabled:e.serviceStatus.miGPTRunning||e.isStarting||e.isRestarting},on:{click:e.startService}},[e._v(" 启动 ")]),e.serviceStatus.miGPTRunning?[t(l,{attrs:{type:"danger",icon:"el-icon-video-pause",loading:e.isStopping,disabled:!e.serviceStatus.miGPTRunning||e.isStopping||e.isRestarting},on:{click:e.stopService}},[e._v(" 停止 ")]),t(l,{attrs:{type:"warning",icon:"el-icon-refresh",loading:e.isRestarting,disabled:e.isRestarting},on:{click:e.restartService}},[e._v(" 重启 ")])]:e._e()],2),t(k,{attrs:{placement:"bottom",width:"400",trigger:"click"}},[t("div",{staticClass:"guide-content"},[t("h3",[e._v("智能管家启动指南")]),e._l(e.guideSteps,function(s,c){return t("div",{key:c,staticClass:"guide-step"},[t("h4",[e._v(e._s(s.title))]),t("p",[e._v(e._s(s.content))]),s.command?t(o,{attrs:{value:s.command,readonly:"",size:"small"}}):e._e()],1)}),t(y,{staticClass:"mt-4",attrs:{type:"info",closable:!1,"show-icon":""}},[t("template",{slot:"title"},[e._v("提示：修改配置后需要重启服务才能生效")])],2)],2),t(l,{attrs:{slot:"reference",type:"primary",icon:"el-icon-question"},slot:"reference"},[e._v("使用指南")])],1)],1)])]),t(w,{model:{value:e.activeTab,callback:function(s){e.activeTab=s},expression:"activeTab"}},[t(C,{attrs:{name:"basic"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"fas fa-cogs"}),e._v(" 基础配置 ")]),t(S,{ref:"configForm",staticClass:"config-form",attrs:{model:e.config,"label-width":"120px"}},[t(I,{attrs:{accordion:""}},[t(p,{attrs:{title:"智能助手配置",name:"1"}},[t(i,{attrs:{label:"助手名称",rules:[{required:!0,message:"请输入智能助手名称",trigger:"blur"}]}},[t(o,{attrs:{placeholder:"例如：小美"},model:{value:e.config.bot.name,callback:function(s){e.$set(e.config.bot,"name",s)},expression:"config.bot.name"}})],1),t(i,{attrs:{label:"助手简介"}},[t(o,{attrs:{type:"textarea",rows:4,placeholder:"请描述智能助手的性格、特点等"},model:{value:e.config.bot.profile,callback:function(s){e.$set(e.config.bot,"profile",s)},expression:"config.bot.profile"}}),t("div",{staticClass:"form-tip"},[e._v("建议包含性别、性格、专长等特征")])],1)],1),t(p,{attrs:{title:"用户配置",name:"2"}},[t(i,{attrs:{label:"用户名称",rules:[{required:!0,message:"请输入用户名称",trigger:"blur"}]}},[t(o,{attrs:{placeholder:"您的称呼"},model:{value:e.config.master.name,callback:function(s){e.$set(e.config.master,"name",s)},expression:"config.master.name"}})],1),t(i,{attrs:{label:"用户简介"}},[t(o,{attrs:{type:"textarea",rows:4,placeholder:"请描述您的兴趣、习惯等"},model:{value:e.config.master.profile,callback:function(s){e.$set(e.config.master,"profile",s)},expression:"config.master.profile"}}),t("div",{staticClass:"form-tip"},[e._v("有助于智能助手更好地为您服务")])],1)],1),t(p,{attrs:{title:"账号设置",name:"3"}},[t(i,{attrs:{label:"小米ID",rules:[{required:!0,message:"请输入小米ID",trigger:"blur"}]}},[t(o,{model:{value:e.config.speaker.userId,callback:function(s){e.$set(e.config.speaker,"userId",s)},expression:"config.speaker.userId"}},[t("template",{slot:"append"},[t(u,{attrs:{content:"请在小米账号的「个人信息」-「小米 ID」中查看",placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1)],2)],1),t(i,{attrs:{label:"账号密码",rules:[{required:!0,message:"请输入账号密码",trigger:"blur"}]}},[t(o,{attrs:{type:"password","show-password":""},model:{value:e.config.speaker.password,callback:function(s){e.$set(e.config.speaker,"password",s)},expression:"config.speaker.password"}})],1),t(i,{attrs:{label:"设备名称",rules:[{required:!0,message:"请输入设备名称",trigger:"blur"}]}},[t(o,{model:{value:e.config.speaker.did,callback:function(s){e.$set(e.config.speaker,"did",s)},expression:"config.speaker.did"}},[t("template",{slot:"append"},[t(u,{attrs:{content:"小爱音箱 DID 或在米家中设置的名称",placement:"top"}},[t("i",{staticClass:"el-icon-question"})])],1)],2)],1)],1),t(p,{attrs:{title:"高级设置",name:"6"}},[t(i,{staticClass:"keyword-select",attrs:{label:"调用AI键词"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择关键词"},model:{value:e.config.speaker.callAIKeywords,callback:function(s){e.$set(e.config.speaker,"callAIKeywords",s)},expression:"config.speaker.callAIKeywords"}},e._l(["请","你","智能助手"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"唤醒关键词"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择唤醒关键词"},model:{value:e.config.speaker.wakeUpKeywords,callback:function(s){e.$set(e.config.speaker,"wakeUpKeywords",s)},expression:"config.speaker.wakeUpKeywords"}},e._l(["打开","进入","激活"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"退出关键词"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择退出关键词"},model:{value:e.config.speaker.exitKeywords,callback:function(s){e.$set(e.config.speaker,"exitKeywords",s)},expression:"config.speaker.exitKeywords"}},e._l(["关闭","退出","再见"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"进入提示语"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择入提示语"},model:{value:e.config.speaker.onEnterAI,callback:function(s){e.$set(e.config.speaker,"onEnterAI",s)},expression:"config.speaker.onEnterAI"}},e._l(["您好，我是您的智能助手"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"退出提示语"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择退出提示语"},model:{value:e.config.speaker.onExitAI,callback:function(s){e.$set(e.config.speaker,"onExitAI",s)},expression:"config.speaker.onExitAI"}},e._l(["再见，期待下次为您服务"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"AI思考提示语"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择AI思考提示语"},model:{value:e.config.speaker.onAIAsking,callback:function(s){e.$set(e.config.speaker,"onAIAsking",s)},expression:"config.speaker.onAIAsking"}},e._l(["让我思考一下"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"AI回答提示语"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择AI回答提示语"},model:{value:e.config.speaker.onAIReplied,callback:function(s){e.$set(e.config.speaker,"onAIReplied",s)},expression:"config.speaker.onAIReplied"}},e._l(["我的回答是"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1),t(i,{staticClass:"keyword-select",attrs:{label:"AI错误提示语"}},[t(r,{attrs:{multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入或选择AI错误提示语"},model:{value:e.config.speaker.onAIError,callback:function(s){e.$set(e.config.speaker,"onAIError",s)},expression:"config.speaker.onAIError"}},e._l(["抱歉，我遇到了一些问题"],function(s){return t(n,{key:s,attrs:{label:s,value:s}})}),1),t("div",{staticClass:"form-tip"},[e._v("支持自定义添加，按回车确认")])],1)],1)],1)],1)],1)],1),t("div",{staticClass:"form-actions"},[t(l,{attrs:{type:"primary"},on:{click:e.saveConfig}},[e._v(" 保存配置 ")])],1)],1)],1)},E=[],z=T(N,R,E,!1,null,null,null,null);const K=z.exports;export{K as default};
